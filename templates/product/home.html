<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <title>Bookmazon</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico"/>
    <!-- Bootstrap icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocas/4.2.5/tocas.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocas/4.2.5/tocas.min.js"></script>
    <!-- Core theme CSS (includes Bootstrap)-->
    <!-- <link href="css/styles.css" rel="stylesheet" />-->
    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet"/>
    <link href="{{ url_for('static', filename='css/slide.css') }}" rel="stylesheet"/>
    <link href="{{ url_for('static', filename='css/book.css') }}" rel="stylesheet"/>
    <link href="{{ url_for('static', filename='css/search.css') }}" rel="stylesheet"/>

    <style>
    .book {
        max-height: 300px; /* 設定書名容器的最大高度，可以根據需要調整 */
        overflow: hidden;
    }

    .book a {
        display: block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis; /* 顯示省略號 */
    }
    </style>

</head>

<body>
{% include 'product/header.html' %}
<div class="slider">
    <div class="list">
        <div class="item">
            <img src="{{ url_for('static', filename='assets/img/bookstore_1.jpg') }}" alt="">
        </div>
        <div class="item">
            <img src="{{ url_for('static', filename='assets/img/bookstore_2.jpg') }}" alt="">
        </div>
        <div class="item">
            <img src="{{ url_for('static', filename='assets/img/bookstore_3.jpg') }}" alt="">
        </div>
        <div class="item">
            <img src="{{ url_for('static', filename='assets/img/bookstore_4.jpg') }}" alt="">
        </div>
        <div class="item">
            <img src="{{ url_for('static', filename='assets/img/bookstore_5.jpg') }}" alt="">
        </div>
    </div>
    <div class="buttons">
        <button id="prev"><</button>
        <button id="next">></button>
    </div>
    <ul class="dots">
        <li class="active"></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>
</div>

<div class="px-4 pt-3 my-5 text-center border-bottom">
    <h1 class="display-4 fw-bold text-body-emphasis">平台初衷</h1>
    <div class="col-lg-6 mx-auto">
        <p class="lead mb-4">主要是讓每位學長姊可以藉由平台販賣二手書，讓二手教科書得以重複利用，也讓學生每學期購書的負擔降低，同時減少資源浪費，落實地球永續</p>
        <div class="d-grid gap-2 d-sm-flex justify-content-sm-center mb-5">
            <button type="button" class="btn btn-primary btn-lg px-4 me-sm-3" id="scrollToNewBooksButton">新書上架</button>
            <button type="button" class="btn btn-outline-secondary btn-lg px-4" id="scrollToRecommendBooksButton">精選推薦
            </button>
        </div>
    </div>
    <div class="overflow-hidden" style="max-height: 30vh;">
        <div class="container px-5">
            <img src="{{ url_for('static', filename='assets/img/bookstore_6.jpg') }}"
                 class="img-fluid border rounded-3 shadow-lg mb-4" alt="Example image" width="700" height="500"
                 loading="lazy">
        </div>
    </div>
</div>

<div class="container px-4 py-5" id="custom-cards">
    <h2 class="pb-2 border-bottom">Custom cards</h2>

    <div class="row row-cols-1 row-cols-lg-3 align-items-stretch g-4 py-5">
        <div class="col">
            <div class="card card-cover h-100 overflow-hidden text-bg-dark rounded-4 shadow-lg"
                 style="background-image: url('unsplash-photo-1.jpg');">
                <div class="d-flex flex-column h-100 p-5 pb-3 text-white text-shadow-1">
                    <h3 class="pt-5 mt-5 mb-4 display-6 lh-1 fw-bold">今日優惠</h3>
                    <ul class="d-flex list-unstyled mt-auto">
                        <li class="me-auto">
                            <img src="https://github.com/twbs.png" alt="Bootstrap" width="32" height="32"
                                 class="rounded-circle border border-white">
                        </li>
                        <li class="d-flex align-items-center me-3">
                            <svg class="bi me-2" width="1em" height="1em">
                                <use xlink:href="#geo-fill"></use>
                            </svg>
                            <small>Earth</small>
                        </li>
                        <li class="d-flex align-items-center">
                            <svg class="bi me-2" width="1em" height="1em">
                                <use xlink:href="#calendar3"></use>
                            </svg>
                            <small>3d</small>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card card-cover h-100 overflow-hidden text-bg-dark rounded-4 shadow-lg"
                 style="background-image: url('unsplash-photo-2.jpg');">
                <div class="d-flex flex-column h-100 p-5 pb-3 text-white text-shadow-1">
                    <h3 class="pt-5 mt-5 mb-4 display-6 lh-1 fw-bold">暢銷排行</h3>
                    <ul class="d-flex list-unstyled mt-auto">
                        <li class="me-auto">
                            <img src="https://github.com/twbs.png" alt="Bootstrap" width="32" height="32"
                                 class="rounded-circle border border-white">
                        </li>
                        <li class="d-flex align-items-center me-3">
                            <svg class="bi me-2" width="1em" height="1em">
                                <use xlink:href="#geo-fill"></use>
                            </svg>
                            <small>Pakistan</small>
                        </li>
                        <li class="d-flex align-items-center">
                            <svg class="bi me-2" width="1em" height="1em">
                                <use xlink:href="#calendar3"></use>
                            </svg>
                            <small>4d</small>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card card-cover h-100 overflow-hidden text-bg-dark rounded-4 shadow-lg"
                 style="background-image: url('unsplash-photo-3.jpg');">
                <div class="d-flex flex-column h-100 p-5 pb-3 text-shadow-1">
                    <h3 class="pt-5 mt-5 mb-4 display-6 lh-1 fw-bold">社群</h3>
                    <ul class="d-flex list-unstyled mt-auto">
                        <li class="me-auto">
                            <img src="https://github.com/twbs.png" alt="Bootstrap" width="32" height="32"
                                 class="rounded-circle border border-white">
                        </li>
                        <li class="d-flex align-items-center me-3">
                            <svg class="bi me-2" width="1em" height="1em">
                                <use xlink:href="#geo-fill"></use>
                            </svg>
                            <small>California</small>
                        </li>
                        <li class="d-flex align-items-center">
                            <svg class="bi me-2" width="1em" height="1em">
                                <use xlink:href="#calendar3"></use>
                            </svg>
                            <small>5d</small>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="new-books-section">
    <h2 class="pb-2 border-bottom">新書上架</h2>
    <div class="new-books-container" id="newBooksContainer"></div>
    <button id="prevButton">上一頁</button>
    <button id="nextButton">下一頁</button>
</div>

<div class="recommend-books-section">
    <h2 class="pb-2 border-bottom">精選推薦</h2>
    <div class="recommend-books-container" id="recommendBooksContainer"></div>
</div>


{% include './common/footer.html' %}
<script src="{{ url_for('static', filename='js/slide.js') }}"></script>
<script src="{{ url_for('static', filename='js/search.js') }}"></script>
</body>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let currentPage = 1;
        const booksPerPage = 8;

        const newBooksContainer = document.getElementById("newBooksContainer");
        const recommendBooksContainer = document.getElementById("recommendBooksContainer")

        const scrollToNewBooksButton = document.getElementById("scrollToNewBooksButton");
        const scrollToRecommendBooksButton = document.getElementById("scrollToRecommendBooksButton");

        const prevButton = document.getElementById("prevButton");
        const nextButton = document.getElementById("nextButton");

        // 獲取最近搜尋的元素
        const recentSearches = document.getElementById('recentSearches');
        const searchList = document.getElementById('searchList');

        // 使用 Jinja2 嵌入數據到 JavaScript 中
        const booksData = [
            {% for book in data%}
                {
                    title: "{{ book.book_name }}",
                    author: "{{ book.book_author }}",
                    price: "{{ book.book_price }}",
                    id: "{{ book.item_id }}",
                    image:"{{ book.book_image_path }}"
                },
            {% endfor %}
        ];

        // 初始化顯示書籍
        updateBooks();

        // 切換到上一頁
        prevButton.addEventListener("click", function () {
            if (currentPage > 1) {
                currentPage--;
                updateBooks();
            }
        });

        // 切換到下一頁
        nextButton.addEventListener("click", function () {
            const totalPages = Math.ceil(booksData.length / booksPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                updateBooks();
            }
        });

        // 滾動至新書上架區域
        scrollToNewBooksButton.addEventListener("click", function () {
            newBooksContainer.scrollIntoView({behavior: "smooth"});
        });

        // 滾動至精選推薦區域
        scrollToRecommendBooksButton.addEventListener("click", function () {
            recommendBooksContainer.scrollIntoView({behavior: "smooth"});
        });

        // 更新呈現頁面
        function updateBooks() {
            const startIndex = (currentPage - 1) * booksPerPage;
            const endIndex = startIndex + booksPerPage;
            const displayedBooks = booksData.slice(startIndex, endIndex);

            // 清空容器
            newBooksContainer.innerHTML = "";

            // 創建書籍元素並将它們附加到容器
            displayedBooks.forEach(book => {
                const newBookElement = createBookElement(book);
                newBooksContainer.appendChild(newBookElement);
            });
        }

        // 創建書籍元件
        function createBookElement(book) {
            const BookElement = document.createElement("div");
            BookElement.classList.add("book");

            const imageElement = document.createElement("img");
            imageElement.src = '../static/'+book.image;
            imageElement.alt = book.title;

            const titleLinkElement = document.createElement("a");
            // 將book.id嵌入到data屬性中
            titleLinkElement.dataset.bookId = book.id;
            titleLinkElement.href = `/getProduct/${book.id}`;
            titleLinkElement.textContent = book.title;

            const authorElement = document.createElement("p");
            authorElement.textContent = `作者: ${book.author}`;

            const priceElement = document.createElement("p");
            priceElement.textContent = `價格: ${book.price}`;

            BookElement.appendChild(imageElement);
            BookElement.appendChild(titleLinkElement);
            BookElement.appendChild(authorElement);
            BookElement.appendChild(priceElement);

            return BookElement;
        }
    });

    //進階搜尋的下拉選單
    function toggleAdvancedOptions() {
        var advancedOptions = document.getElementById("advancedOptions");
        advancedOptions.classList.toggle("hidden");
    }

    // 將搜尋內容送到後端處理
    document.getElementById('searchForm').addEventListener('submit', function(event) {

        var keyword = document.getElementById('searchInput').value;
        window.location.href = '/searchProduct/' + keyword;
    });

    // 更新最近搜尋的紀錄
    function updateRecentSearches(keyword) {
        // 獲取目前的最近搜尋紀錄
        const recentSearchesData = JSON.parse(localStorage.getItem('recentSearches')) || [];

        // 將新搜尋的 keyword 加到最前面
        recentSearchesData.unshift(keyword);

        // 去重複
        const uniqueSearches = [...new Set(recentSearchesData)];

        // 限制最多顯示 5 筆搜尋
        const limitedSearches = uniqueSearches.slice(0, 5);

        // 更新本地存儲
        localStorage.setItem('recentSearches', JSON.stringify(limitedSearches));

        // 更新最近搜尋的列表顯示
        updateRecentSearchesUI(limitedSearches);
    }

    // 更新最近搜尋的列表顯示
    function updateRecentSearchesUI(searches) {
        // 清空原有列表
        searchList.innerHTML = '';

        // 將最近搜尋加到列表中
        searches.forEach(search => {
            const listItem = document.createElement('li');
            listItem.textContent = search;
            searchList.appendChild(listItem);
        });

        // 顯示最近搜尋的區塊
        recentSearches.style.display = searches.length > 0 ? 'block' : 'none';
    }
</script>
</html>